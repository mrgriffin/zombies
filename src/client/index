<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ping example</title>
</head>
<body>
<div id="pongs"><h1>Pongs</h1></div>
<input id="ping" type="button" value="Ping!">
<script>
document.getElementById('ping').addEventListener('click', function (e) {
	request = new XMLHttpRequest();
	request.open('GET', '/ping', true);
	request.send(null);
}, false);

// TODO: Use a while loop and a synchronous XMLHttpRequest?
function awaitPong() {
	request = new XMLHttpRequest();
	request.onreadystatechange = pongRequestReadyStateChange;
	request.open('GET', '/pong', true);
	request.send(null);
}

// FIXME: Occasionally we lose the first response.
function pongRequestReadyStateChange() {
	if (request.readyState == 4) {
		if (request.status == 200) {
			document.getElementById('pongs').appendChild(document.createTextNode('Pong!'));
			document.getElementById('pongs').appendChild(document.createElement('br'));
		}
		awaitPong();
	}
}

awaitPong();
</script>
</body>
</html>
